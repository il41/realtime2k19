<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>NOW THATS WHAT I CALL REALTIME</title>
    <script src="js/p5.min.js"></script>
    <script src="js/p5.sound.min.js"></script>
    <script src="js/three.min.js"></script>
    <script src="js/OBJLoader.js"></script>
    <style>
      body,html{
        margin:0;
        /* height:100%; */
      }
      body{
        align-items: center;
        display:flex;
        justify-content: space-between;
        flex-direction: column;
        text-align: center;
        background-color:black;
        color:white;

      }
      #logo{
        width:1000px;
        height:200px;
        background-color:black;
      }
    </style>
  </head>
  <body>
    <div id="logo"></div>
    <h1> NOW </h1><h2> That's What I Call Realtime</h2>
    <h3>An evening of realtime audio/video performances.</h3>



    <script>
      let div = document.getElementById('logo')
      let width=div.offsetWidth;
      let height=div.offsetHeight;
      let camera,renderer,scene;
      let mySound;
      let playing =0;
      let fft = new p5.FFT();

      div.addEventListener("click", () => {
        if(playing==0){
          mySound = loadSound('song.mp3',()=>{
            mySound.connect(fft);
            mySound.loop();
            // mySound.play();
            playing=1;


          })
        }
        // mySound.play();
      });






      init();

      let mat1 = new THREE.MeshNormalMaterial({
        // color:'blue'
      });
      let loader = new THREE.OBJLoader();
      let logo;
      // let logoMesh =  new THREE.geometry
      // load a resource
      loader.load(
      	// resource URL
      	'realtime1.obj',
      	// called when resource is loaded
      	function ( object ) {
          logo = object
          logo.material=mat1;
          scene.add(logo);
      	},
      	// called when loading is in progresses
      	function ( xhr ) {
      		console.log( ( xhr.loaded / xhr.total * 100 ) + '% loaded' );
      	},
      	// called when loading has errors
      	function ( error ) {
      		console.log( 'An error happened' );
      	}
      );







      function init(){
        renderer = new THREE.WebGLRenderer( { preserveDrawingBuffer: true } );

        renderer.setSize(width,height);
        div.appendChild(renderer.domElement);

        camera=new THREE.PerspectiveCamera(15,width/height,0.01,1000);
        camera.position.x = 0;
        camera.position.y = 0;
        camera.position.z = 15;

        scene = new THREE.Scene();

        // cube = new THREE.Mesh(new THREE.CubeGeometry(1,1,1),new THREE.MeshLambertMaterial({
        //   // color:'blue',
        // }));

        light = new THREE.DirectionalLight('white',1);
        light.position.set(10,10,10).normalize();
        scene.add(light);
        // scene.add(cube);
        // cube.position.x=0;
        // cube.position.y=0;
        // cube.position.z=0;

        // window.addEventListener('resize',onWindowResize,false);
        render();
      }
      function render(){
        renderer.autoclear=false;
        renderer.render(scene,camera);
      }
      function draw(){
        if(playing==1){
          let spectrum = fft.analyze();
          camera.position.z=map(spectrum[500],0,255,20,3)
          mySound.rate(Math.sin(logo.rotation.y))
          let speed = mySound.rate(Math.sin(logo.rotation.y))
          if(speed>0.4){
            mySound.rate(constrain(Math.sin(logo.rotation.y)*1.4,0,1))
          }

          // camera.position.z=fft.getEnergy();
        }
        // let waveform = fft.waveform();
        logo.rotation.y +=.002;
        // logo.rotation.x +=4;

        render();
        // console.log('draw');
      }
      setInterval(draw,1);






    </script>
  </body>
</html>
